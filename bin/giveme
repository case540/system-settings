#!/bin/bash

function quota()
{
    day=$(date | cut -f1 -d ' ')
    if [[ ( $day == "Sun" ) || ( $day == "Sat" ) ]]
    then
        QUOTA=120
    else
        QUOTA=30
    fi
}

function give_me()
{
    let SPENT=$(head -n 1 ~/.config/giveme/spent.log)
    let ASKING=$(($SPENT + $1))
    quota
    if [[ $ASKING -gt $QUOTA ]]
    then
        echo "Rejected, you have already spent $SPENT minutes"
        exit 1
    else
        kill -9 $2
        let seconds=$(($1 * 60))
        (sleep $seconds && google-chrome chrome-extension://laankejkbhbdhmipfmgcngdelahlfoji/options.html) &
        sudo chattr -i ~/.config/giveme/spent.log
        sudo chmod 740 ~/.config/giveme/spent.log
        sudo echo 0 > ~/.config/giveme/spent.log
        sudo chmod 400 ~/.config/giveme/spent.log
        sudo chattr +i ~/.config/giveme/spent.log
    fi
}

give_me $1 $2
